import numpy as np
import matplotlib.pyplot as plt

import System as sys
import Geotiff as gt
import Print as prt
import Cad as cad
import Geometry as gmt

def main():

    cell = gt.Dataset('data/rifle/satellite.tif')

    # Boundary and fence
    z = gt.Dataset('data/rifle/terrain-masked.tif')
    xc,yc,wc,hc = z.bounds()
    
    # Geofence
    xb,yb = z.boundary()
    xf,yf = gmt.offset(xb, yb, -60) 
    
    (ax1, ax2, ax3) = cad.plots(1, 3)
    cell.show(ax1)
    cad.lines(ax1, xb, yb, 'red')
    cad.lines(ax1, xf, yf, 'blue')

    cad.limits(ax2, bounds = cell.bounds())
    cad.lines(ax2, xb, yb, 'red')
    cad.lines(ax2, xf, yf, 'blue')

    x = np.max(xf)
    y = np.min(yf)
    cad.point(ax1, x, y, color='red')
    cad.point(ax2, x, y, color='red')

  
    fig, ax4 = plt.subplots(subplot_kw=dict(projection='3d'))
    cad.update()
    
    v = 1 # m/s
    w = 5 # m
    h = 9 # m

    d = 0
    o = 0

    while(True):
        
        z = gt.Dataset('data/rifle/terrain-masked.tif', x + o, y - h/2, w, h)
        a = z.data()
            
        z.draw(ax1,'red',.25)
        cad.point(ax1, x, y, color='red')

        z.show(ax2)
        cad.point(ax2, x, y, color='red')

        cad.clear(ax3)
        z.show(ax3)

        ax4.clear()
        z.surface(ax4)
    
        cad.update()

        # Next move
        if (not gmt.contains(xf, yf, x + w, y) and v > 0 and x > xc + wc/2) or (not gmt.contains(xf, yf, x - w, y) and v < 0 and x < xc + wc/2):
            v = -v
            y = y + h
            d = d + h
            if o == 0:
                o = -h
            elif o == -h:
                o = 0
        else:
            x = x + v*w
            d = d + w

    cad.pause()

    print('Good job!')
    
if __name__ == "__main__":
    main() 

# 36 x 20
#[[1836.5117 1836.5117 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172]
# [1836.5117 1836.5117 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172]
# [1836.5117 1836.5117 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172]
# [1836.5117 1836.5117 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172]
# [1836.5117 1836.5117 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172]
# [1836.5117 1836.5117 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172]
# [1836.5117 1836.5117 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172]
# [1836.5117 1836.5117 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172]
# [1836.5117 1836.5117 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172]
# [1836.5117 1836.5117 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172]
# [1836.5117 1836.5117 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172]
# [1836.5117 1836.5117 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172]
# [1836.5117 1836.5117 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172 1836.6172]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.2852 1836.2852 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867 1836.3867]
# [1836.0547 1836.0547 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523]
# [1836.0547 1836.0547 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523]
# [1836.0547 1836.0547 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523]
# [1836.0547 1836.0547 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523 1836.1523]]